# OhMyKube

<p align="center">
  <strong>åœ¨çœŸå®è™šæ‹Ÿæœºä¸Šå¿«é€Ÿæ­å»ºå®Œæ•´çš„Kubernetesç¯å¢ƒ</strong>
</p>

<p align="center">
  <a href="#æ ¸å¿ƒç‰¹æ€§">æ ¸å¿ƒç‰¹æ€§</a> â€¢
  <a href="#ä¸ºä»€ä¹ˆé€‰æ‹©OhMyKube">ä¸ºä»€ä¹ˆé€‰æ‹©OhMyKube</a> â€¢
  <a href="#å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</a> â€¢
  <a href="#ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</a> â€¢
  <a href="#è¯¦ç»†æ–‡æ¡£">è¯¦ç»†æ–‡æ¡£</a> â€¢
  <a href="#è·¯çº¿å›¾">è·¯çº¿å›¾</a>
</p>

OhMyKube æ˜¯ä¸€ä¸ªåŸºäºçœŸå®è™šæ‹Ÿæœºæ„å»ºçš„Kubernetesé›†ç¾¤åˆ›å»ºå·¥å…·ï¼Œå¡«è¡¥äº†å®¹å™¨åŒ–å·¥å…·ï¼ˆå¦‚kindã€k3dï¼‰ä¸ç”Ÿäº§çº§åˆ«å·¥å…·ï¼ˆå¦‚kubesprayã€sealosï¼‰ä¹‹é—´çš„ç©ºç™½ã€‚å®ƒé€šè¿‡Multipassè™šæ‹ŸåŒ–æŠ€æœ¯å’Œkubeadmï¼Œæä¾›æ¯”å®¹å™¨æ›´çœŸå®ä½†æ¯”æ‰‹åŠ¨éƒ¨ç½²æ›´ç®€å•çš„Kubernetesç¯å¢ƒã€‚

## æ ¸å¿ƒç‰¹æ€§

- ğŸŒŸ **çœŸå®è™šæ‹Ÿæœº**ï¼šä½¿ç”¨ç‹¬ç«‹VMè€Œéå®¹å™¨æ¥è¿è¡ŒKubernetesèŠ‚ç‚¹ï¼Œæ›´æ¥è¿‘ç”Ÿäº§ç¯å¢ƒ
- ğŸ”„ **ä¸€é”®éƒ¨ç½²**ï¼šç®€å•çš„å‘½ä»¤è¡Œæ¥å£ï¼Œå¿«é€Ÿåˆ›å»ºã€åˆ é™¤ã€æ‰©å±•é›†ç¾¤
- ğŸ§© **ç½‘ç»œæ’ä»¶é€‰æ‹©**ï¼šæ”¯æŒFlannelï¼ˆé»˜è®¤ï¼‰å’ŒCiliumï¼Œæ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚
- ğŸ’¾ **å­˜å‚¨é›†æˆ**ï¼šè‡ªåŠ¨å®‰è£…Local-Path-Provisioneræˆ–Rook-Cephå­˜å‚¨ç³»ç»Ÿ
- ğŸ”Œ **è´Ÿè½½å‡è¡¡**ï¼šå†…ç½®MetalLBï¼Œæä¾›çœŸå®çš„LoadBalanceræœåŠ¡ä½“éªŒ
- ğŸ› ï¸ **é«˜åº¦çµæ´»**ï¼šæ”¯æŒè‡ªå®šä¹‰kubeadmé…ç½®ï¼Œå¯è°ƒèŠ‚èµ„æºåˆ†é…
- ğŸš€ **å¿«é€ŸèŠ‚ç‚¹ç®¡ç†**ï¼šè½»æ¾æ·»åŠ æˆ–åˆ é™¤å·¥ä½œèŠ‚ç‚¹

## ä¸ºä»€ä¹ˆé€‰æ‹©OhMyKube

åœ¨ä¼—å¤šKuberneteså·¥å…·ä¸­ï¼ŒOhMyKubeæœ‰å…¶ç‹¬ç‰¹ä»·å€¼ï¼š

| ç‰¹æ€§ | Kind/K3d | OhMyKube | Kubespray/Sealos |
|------|----------|----------|------------------|
| ç¯å¢ƒçœŸå®åº¦ | ğŸŸ¡ å®¹å™¨æ¨¡æ‹Ÿ | ğŸŸ¢ çœŸå®VM | ğŸŸ¢ ç”Ÿäº§çº§ |
| èµ„æºéš”ç¦» | ğŸŸ¡ å®¹å™¨çº§ | ğŸŸ¢ VMçº§ | ğŸŸ¢ ç‰©ç†/VMçº§ |
| æ˜“ç”¨æ€§ | ğŸŸ¢ éå¸¸ç®€å• | ğŸŸ¢ ç®€å• | ğŸŸ¡ è¾ƒå¤æ‚ |
| å¯åŠ¨é€Ÿåº¦ | ğŸŸ¢ æå¿« | ğŸŸ¡ ä¸­ç­‰ | ğŸ”´ è¾ƒæ…¢ |
| é€‚åˆæœ¬åœ°å¼€å‘ | ğŸŸ¢ æ˜¯ | ğŸŸ¢ æ˜¯ | ğŸŸ¡ å¯ä»¥ä½†é‡ |
| æ¥è¿‘ç”Ÿäº§ç¯å¢ƒ | ğŸ”´ å·®å¼‚å¤§ | ğŸŸ¢ ç›¸ä¼¼ | ğŸŸ¢ å®Œå…¨ä¸€è‡´ |
| ç½‘ç»œæ¨¡å‹ | ğŸŸ¡ ç®€åŒ– | ğŸŸ¢ çœŸå® | ğŸŸ¢ çœŸå® |
| å­˜å‚¨æ”¯æŒ | ğŸŸ¡ æœ‰é™ | ğŸŸ¢ å…¨é¢ | ğŸŸ¢ å…¨é¢ |
| ç¡¬ä»¶è¦æ±‚ | ğŸŸ¢ ä½ | ğŸŸ¡ ä¸­ç­‰ | ğŸ”´ é«˜ |

## å¿«é€Ÿå¼€å§‹

### å‰ææ¡ä»¶

1. å®‰è£… [Multipass](https://multipass.run/)
2. å®‰è£… Go 1.23.0 æˆ–æ›´é«˜ç‰ˆæœ¬

### å®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/monshunter/ohmykube.git
cd ohmykube

# ç¼–è¯‘å®‰è£…
make install
```

### åŸºæœ¬ç”¨æ³•

```bash
# åˆ›å»ºé›†ç¾¤ï¼ˆé»˜è®¤1ä¸ªmaster + 2ä¸ªworkerï¼‰
ohmykube up

# æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
export KUBECONFIG=~/.kube/config-ohmykube
kubectl get nodes

# åˆ é™¤é›†ç¾¤
ohmykube down
```

## ä½¿ç”¨åœºæ™¯

- **å¼€å‘æµ‹è¯•**ï¼šåœ¨ä¸ç”Ÿäº§ç¯å¢ƒç›¸ä¼¼çš„è®¾ç½®ä¸­æµ‹è¯•åº”ç”¨ç¨‹åº
- **å­¦ä¹ Kubernetes**ï¼šäº†è§£çœŸå®Kubernetesé›†ç¾¤çš„å·¥ä½œåŸç†
- **æœ¬åœ°CI/CD**ï¼šåœ¨æœ¬åœ°æ„å»ºå®Œæ•´çš„é›†æˆæµ‹è¯•ç¯å¢ƒ
- **ç½‘ç»œå’Œå­˜å‚¨ç ”ç©¶**ï¼šæµ‹è¯•ä¸åŒçš„CNIå’ŒCSIç»„åˆ
- **é›†ç¾¤ç®¡ç†å®è·µ**ï¼šå­¦ä¹ èŠ‚ç‚¹ç®¡ç†ã€ç»´æŠ¤å’Œæ•…éšœæ’é™¤

## è¯¦ç»†æ–‡æ¡£

### åˆ›å»ºå®šåˆ¶é›†ç¾¤

```bash
# è‡ªå®šä¹‰èŠ‚ç‚¹æ•°é‡å’Œèµ„æº
ohmykube up --workers 3 --master-cpu 4 --master-memory 8192 --master-disk 20 \
            --worker-cpu 2 --worker-memory 4096 --worker-disk 10

# é€‰æ‹©ç½‘ç»œæ’ä»¶
ohmykube up --cni cilium

# é€‰æ‹©å­˜å‚¨æ’ä»¶
ohmykube up --csi rook-ceph

# ä½¿ç”¨è‡ªå®šä¹‰kubeadmé…ç½®
ohmykube up --kubeadm-config /path/to/custom-kubeadm-config.yaml
```

### é›†ç¾¤ç®¡ç†

```bash
# æ·»åŠ èŠ‚ç‚¹
ohmykube add --cpu 2 --memory 4096 --disk 20

# åˆ é™¤èŠ‚ç‚¹
ohmykube delete ohmykube-worker-2

# å¼ºåˆ¶åˆ é™¤ï¼ˆä¸å…ˆé©±é€Podï¼‰
ohmykube delete ohmykube-worker-2 --force

# ä¸‹è½½kubeconfig
ohmykube download-kubeconfig
```

### è‡ªå®šä¹‰Kubeadmé…ç½®

æ‚¨å¯ä»¥æä¾›è‡ªå®šä¹‰çš„kubeadmé…ç½®æ–‡ä»¶æ¥è¦†ç›–é»˜è®¤é…ç½®ï¼Œæ”¯æŒä»¥ä¸‹éƒ¨åˆ†ï¼š

- InitConfiguration
- ClusterConfiguration
- KubeletConfiguration
- KubeProxyConfiguration

ç¤ºä¾‹ï¼š

```yaml
apiVersion: kubeadm.k8s.io/v1beta4
kind: InitConfiguration
nodeRegistration:
  criSocket: unix:///var/run/containerd/containerd.sock
---
apiVersion: kubeadm.k8s.io/v1beta4
kind: ClusterConfiguration
kubernetesVersion: v1.33.0
networking:
  podSubnet: 192.168.0.0/16
  serviceSubnet: 10.96.0.0/12
```

## è·¯çº¿å›¾

æˆ‘ä»¬æ­£åœ¨è§„åˆ’ä»¥ä¸‹åŠŸèƒ½å¢å¼ºï¼š

### å³å°†æ¨å‡º ğŸš€

- **é•œåƒç®¡ç†å¢å¼º**
  - æœ¬åœ°Harborä»“åº“æ”¯æŒ (`ohmykube registry`)
  - é•œåƒåŒæ­¥å·¥å…· (`ohmykube load`ï¼Œç±»ä¼¼kind load)
  - é•œåƒç¼“å­˜æœºåˆ¶ï¼ŒåŠ é€Ÿé›†ç¾¤åˆ›å»º

- **å¤šé›†ç¾¤ç®¡ç†**
  - é¡¹ç›®åˆå§‹åŒ– (`ohmykube init`)
  - é›†ç¾¤åˆ‡æ¢ (`ohmykube switch`)
  - æ„å»ºè¿‡ç¨‹checkpointï¼Œæ”¯æŒä¸­æ–­æ¢å¤

### ä¸­æœŸè§„åˆ’ ğŸ”„

- **æä¾›å•†æŠ½è±¡**
  - æ”¯æŒäº‘APIåˆ›å»ºè™šæ‹Ÿæœºï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰
  - æ”¯æŒæ›´å¤šæœ¬åœ°è™šæ‹ŸåŒ–å¹³å°

- **æ›´å¤šå¹³å°æ”¯æŒ**
  - å®Œå–„ä¸åŒCPUæ¶æ„çš„æ”¯æŒ
  - ä¼˜åŒ–Windowsç¯å¢ƒä½“éªŒ

### é•¿æœŸæ„¿æ™¯ ğŸŒˆ

- **æ’ä»¶ç”Ÿæ€ç³»ç»Ÿ**
  - æ’ä»¶æ‰©å±•æœºåˆ¶
  - å¸¸ç”¨æ’ä»¶é›†æˆï¼ˆç›‘æ§ã€æ—¥å¿—ã€CI/CDç­‰ï¼‰

- **å¼€å‘è€…å·¥å…·**
  - IDEé›†æˆ
  - è°ƒè¯•å·¥å…·é“¾
  - å¼€å‘æµç¨‹ä¼˜åŒ–

## æ”¯æŒå¹³å°

- Mac arm64 (ä¼˜å…ˆæ”¯æŒ)
- Linux arm64/amd64
- å…¶ä»–å¹³å°ï¼ˆå®éªŒæ€§æ”¯æŒï¼‰

## è´¡çŒ®

æˆ‘ä»¬æ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ï¼Œæ— è®ºæ˜¯ä»£ç ã€æ–‡æ¡£è¿˜æ˜¯æƒ³æ³•ï¼š

- æäº¤ Issue æŠ¥å‘Šbugæˆ–æå‡ºåŠŸèƒ½éœ€æ±‚
- æäº¤ Pull Request è´¡çŒ®ä»£ç æˆ–æ–‡æ¡£
- å‚ä¸è®¨è®ºï¼Œåˆ†äº«æ‚¨çš„ä½¿ç”¨ç»éªŒ
- å¸®åŠ©æµ‹è¯•æ–°åŠŸèƒ½å’Œå‘å¸ƒç‰ˆæœ¬

## è®¸å¯è¯

MIT